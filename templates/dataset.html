{% extends "base.html" %}

{% block title %}Dataset Prep{% endblock %}

{% block content %}

<h1>Dataset Prep</h1>

<div class="section">
<h2>Dataset Source</h2>

<div class="dataset-source-row">
<div class="field">
<label>Project</label>
<select id="project-select"></select>
</div>

<div class="field">
<label>Dataset path</label>
<input
id="dataset-path-input"
type="text"
placeholder="dataset"
/>
</div>

<button id="load-dataset-btn">Load</button>
</div>

<div
id="dataset-error"
class="warning-box"
style="display:none; margin-top:12px;"
></div>
</div>

<div class="section">
  <h2>Workspace</h2>

  <div class="workspace">

    <div class="image-column">
      <h3>Images</h3>

      <div class="images-pane">
        <input
          id="image-filter"
          type="text"
          placeholder="Filter imagesâ€¦ (ex: 2858 or IMG_28)"
          autocomplete="off"
        />

        <ul id="image-list" class="image-list"></ul>
      </div>

 <div style="margin-top:12px; position: relative;">
  <label style="font-size:13px; color: var(--muted);">
    Square crop size (px)
  </label>

  <div style="display:flex; gap:8px; margin-top:6px; align-items:center;">
    <input
      id="crop-size-input"
      type="number"
      value="512"
      min="64"
      step="64"
      style="width:100px;"
    />

    <div style="position: relative;">
      <button id="crop-btn">
        Crop Images
      </button>

      <div
        id="autocrop-hint"
        style="
          position: absolute;
          left: 50%;
          top: 100%;
          transform: translateX(-50%);
          margin-top: 6px;
          padding: 4px 8px;
          font-size: 12px;
          background: var(--panel);
          border: 1px solid var(--border);
          border-radius: 6px;
          color: var(--muted);
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.2s ease;
          white-space: nowrap;
          z-index: 100;
        "
      >
        Shift + Click â†’ selected image only
      </div>
    </div>
  </div>
 </div>
    </div>

    <div class="preview-column">

      <div class="preview-header">
        <h3>Preview</h3>
        <button
          id="delete-image-btn"
          title="Delete image"
          class="delete-btn"
        >
          ðŸ—‘
        </button>
      </div>

      <div id="image-preview" class="preview-box">
        No image selected
      </div>

      <h3>Caption</h3>
      <textarea
        id="caption-editor"
        rows="4"
        placeholder="Edit caption here..."
      ></textarea>

      <div class="preview-actions">
        <button id="save-captions-btn">Save Captions</button>

        <div style="position: relative; display: inline-block;">
          <button id="autocaption-btn">Auto-caption (BLIP)</button>

          <div
            id="autocaption-hint"
            style="
              position: absolute;
              left: 100%;
              top: 50%;
              transform: translate(8px, -50%);
              padding: 4px 8px;
              font-size: 12px;
              background: var(--panel);
              border: 1px solid var(--border);
              border-radius: 6px;
              color: var(--muted);
              opacity: 0;
              pointer-events: none;
              transition: opacity 0.2s ease;
              white-space: nowrap;
              z-index: 100;
            "
          >
            Shift + Click â†’ selected image only
          </div>
        </div>
      </div>

      <label class="overwrite-toggle">
        <input type="checkbox" id="autocaption-overwrite">
        Overwrite existing captions
      </label>

      <div
        id="autocaption-status"
        style="font-size:14px; color: var(--muted); margin-top:6px;"
      ></div>

    </div>
  </div>
</div>
</div>

{% endblock %}

{% block page_js %}
<script src="{{ url_for('static', filename='dataset.js') }}"></script>
{% endblock %}
